## ç¬¬äº”éƒ¨åˆ†ï¼šè¿›é˜¶æŠ€å·§ä¸é—®é¢˜è§£å†³ - æˆä¸ºGitå¤§å¸ˆçš„ç§˜ç±

æŒæ¡äº†åŸºç¡€æ“ä½œå’Œå›¢é˜Ÿè§„èŒƒåï¼Œè®©æˆ‘ä»¬å­¦ä¹ ä¸€äº›é«˜çº§æŠ€å·§ï¼Œå¸®ä½ åº”å¯¹å„ç§å¤æ‚åœºæ™¯ã€‚

### 5.1 æ ‡ç­¾ç®¡ç†ï¼šç‰ˆæœ¬é‡Œç¨‹ç¢‘

æ ‡ç­¾ï¼ˆTagï¼‰å°±åƒæ¸¸æˆä¸­çš„æˆå°±å¾½ç« ï¼Œæ ‡è®°é‡è¦çš„æ¸¸æˆèŠ‚ç‚¹ã€‚

#### ä»€ä¹ˆæ˜¯Gitæ ‡ç­¾ï¼Ÿ

**æ ‡ç­¾**æ˜¯æŒ‡å‘ç‰¹å®šæäº¤çš„å›ºå®šå¼•ç”¨ï¼Œé€šå¸¸ç”¨äºæ ‡è®°ç‰ˆæœ¬å‘å¸ƒç‚¹ã€‚

**ä¸åˆ†æ”¯çš„åŒºåˆ«ï¼š**

- ğŸ·ï¸ **æ ‡ç­¾**ï¼šå›ºå®šä¸å˜ï¼ŒæŒ‡å‘ç‰¹å®šcommit
- ğŸŒ¿ **åˆ†æ”¯**ï¼šä¼šéšç€æ–°æäº¤è€Œç§»åŠ¨

**æ¸¸æˆç±»æ¯”ï¼š**
æ ‡ç­¾å°±åƒæ¸¸æˆçš„é‡è¦é‡Œç¨‹ç¢‘è®°å½•ï¼š"ç¬¬ä¸€æ¬¡å‡»è´¥BOSS"ã€"è¾¾æˆ50çº§"ã€"é€šå…³ä¸»çº¿"ã€‚

#### åˆ›å»ºæ ‡ç­¾

**1. è½»é‡æ ‡ç­¾ï¼ˆLightweight Tagï¼‰**

```bash
# ä¸ºå½“å‰commitåˆ›å»ºæ ‡ç­¾
git tag v1.0.0

# ä¸ºç‰¹å®šcommitåˆ›å»ºæ ‡ç­¾
git tag v1.0.0 a1b2c3d
```

è½»é‡æ ‡ç­¾åªæ˜¯ä¸€ä¸ªæŒ‡å‘commitçš„å¼•ç”¨ï¼Œç±»ä¼¼ä¹¦ç­¾ã€‚

**2. é™„æ³¨æ ‡ç­¾ï¼ˆAnnotated Tagï¼‰**ï¼ˆæ¨èï¼‰

```bash
# åˆ›å»ºå¸¦æ³¨é‡Šçš„æ ‡ç­¾
git tag -a v1.0.0 -m "Release version 1.0.0"

# ä¸ºç‰¹å®šcommitåˆ›å»ºæ ‡ç­¾
git tag -a v1.0.0 a1b2c3d -m "Release version 1.0.0"
```

é™„æ³¨æ ‡ç­¾åŒ…å«ï¼š

- æ ‡ç­¾å
- æ ‡ç­¾è€…ä¿¡æ¯
- æ—¥æœŸ
- æ ‡ç­¾è¯´æ˜
- GPGç­¾åï¼ˆå¯é€‰ï¼‰

**3. æŸ¥çœ‹æ ‡ç­¾ä¿¡æ¯**

```bash
# æŸ¥çœ‹æ ‡ç­¾ä¿¡æ¯
git show v1.0.0

# è¾“å‡ºç¤ºä¾‹ï¼š
# tag v1.0.0
# Tagger: å¼ ä¸‰ <zhangsan@example.com>
# Date:   Mon Nov 17 10:00:00 2025 +0800
# 
# Release version 1.0.0
# 
# commit a1b2c3d4e5f6...
# ...
```

#### è¯­ä¹‰åŒ–ç‰ˆæœ¬å·ï¼ˆSemantic Versioningï¼‰

ç‰ˆæœ¬å·æ ¼å¼ï¼š**MAJOR.MINOR.PATCH**

```
v1.2.3
â”‚ â”‚ â”‚
â”‚ â”‚ â””â”€ PATCHï¼šè¡¥ä¸ç‰ˆæœ¬ï¼ˆbugä¿®å¤ï¼‰
â”‚ â””â”€â”€â”€ MINORï¼šæ¬¡ç‰ˆæœ¬ï¼ˆæ–°åŠŸèƒ½ï¼Œå‘åå…¼å®¹ï¼‰
â””â”€â”€â”€â”€â”€ MAJORï¼šä¸»ç‰ˆæœ¬ï¼ˆç ´åæ€§å˜æ›´ï¼‰
```

**ç¤ºä¾‹ï¼š**

- `v1.0.0`ï¼šç¬¬ä¸€ä¸ªæ­£å¼ç‰ˆæœ¬
- `v1.1.0`ï¼šæ–°å¢åŠŸèƒ½ï¼Œå‘åå…¼å®¹
- `v1.1.1`ï¼šä¿®å¤bugï¼Œå‘åå…¼å®¹
- `v2.0.0`ï¼šæœ‰ç ´åæ€§å˜æ›´ï¼Œä¸å‘åå…¼å®¹

**å‰ç¼€ï¼š**

- `v1.0.0-alpha`ï¼šå†…éƒ¨æµ‹è¯•ç‰ˆ
- `v1.0.0-beta`ï¼šå…¬å¼€æµ‹è¯•ç‰ˆ
- `v1.0.0-rc.1`ï¼šå‘å¸ƒå€™é€‰ç‰ˆæœ¬
- `v1.0.0`ï¼šæ­£å¼å‘å¸ƒç‰ˆ

#### ç®¡ç†æ ‡ç­¾

**æŸ¥çœ‹æ ‡ç­¾åˆ—è¡¨ï¼š**

```bash
# åˆ—å‡ºæ‰€æœ‰æ ‡ç­¾
git tag

# åˆ—å‡ºç¬¦åˆæ¨¡å¼çš„æ ‡ç­¾
git tag -l "v1.*"

# è¾“å‡ºï¼š
# v1.0.0
# v1.0.1
# v1.1.0
```

**æ¨é€æ ‡ç­¾åˆ°è¿œç¨‹ï¼š**

```bash
# æ¨é€å•ä¸ªæ ‡ç­¾
git push origin v1.0.0

# æ¨é€æ‰€æœ‰æ ‡ç­¾
git push origin --tags

# æ¨é€æ‰€æœ‰annotatedæ ‡ç­¾ï¼ˆæ¨èï¼‰
git push origin --follow-tags
```

**åˆ é™¤æ ‡ç­¾ï¼š**

```bash
# åˆ é™¤æœ¬åœ°æ ‡ç­¾
git tag -d v1.0.0

# åˆ é™¤è¿œç¨‹æ ‡ç­¾
git push origin --delete v1.0.0
# æˆ–è€…
git push origin :refs/tags/v1.0.0
```

**æ£€å‡ºæ ‡ç­¾ï¼š**

```bash
# æŸ¥çœ‹æ ‡ç­¾å¯¹åº”çš„ä»£ç ï¼ˆdetached HEADçŠ¶æ€ï¼‰
git checkout v1.0.0

# åŸºäºæ ‡ç­¾åˆ›å»ºåˆ†æ”¯
git checkout -b hotfix/1.0.1 v1.0.0
```

#### å®æˆ˜åœºæ™¯

**åœºæ™¯1ï¼šå‘å¸ƒæ–°ç‰ˆæœ¬**

```bash
# 1. ç¡®ä¿åœ¨mainåˆ†æ”¯ä¸”ä»£ç æœ€æ–°
git checkout main
git pull

# 2. åˆ›å»ºå‘å¸ƒæ ‡ç­¾
git tag -a v1.0.0 -m "Release version 1.0.0

æ–°åŠŸèƒ½ï¼š
- ç”¨æˆ·æ³¨å†Œå’Œç™»å½•
- ä¸ªäººèµ„æ–™ç®¡ç†
- å¤´åƒä¸Šä¼ 

æ”¹è¿›ï¼š
- ä¼˜åŒ–é¦–é¡µåŠ è½½é€Ÿåº¦
- æ”¹å–„ç§»åŠ¨ç«¯ä½“éªŒ

ä¿®å¤ï¼š
- ä¿®å¤ç™»å½•è¶…æ—¶é—®é¢˜
"

# 3. æ¨é€æ ‡ç­¾
git push origin v1.0.0

# 4. åœ¨Giteaä¸Šåˆ›å»ºReleaseï¼ˆå¯é€‰ï¼‰
# è®¿é—®ä»“åº“çš„Releasesé¡µé¢ï¼ŒåŸºäºæ ‡ç­¾åˆ›å»ºRelease
```

**åœºæ™¯2ï¼šåŸºäºæ—§ç‰ˆæœ¬ä¿®å¤bug**

```bash
# 1. æŸ¥çœ‹ç°æœ‰ç‰ˆæœ¬
git tag -l

# 2. åŸºäºv1.0.0åˆ›å»ºhotfixåˆ†æ”¯
git checkout -b hotfix/1.0.1 v1.0.0

# 3. ä¿®å¤bugå¹¶æäº¤
# ...

# 4. åˆ›å»ºæ–°æ ‡ç­¾
git tag -a v1.0.1 -m "Hotfix: ä¿®å¤ç™»å½•é—®é¢˜"

# 5. æ¨é€
git push origin hotfix/1.0.1
git push origin v1.0.1
```

**åœºæ™¯3ï¼šå›æ»šåˆ°ç‰¹å®šç‰ˆæœ¬**

```bash
# æŸ¥çœ‹ç‰ˆæœ¬å†å²
git tag -l

# æ£€å‡ºç‰¹å®šç‰ˆæœ¬æŸ¥çœ‹
git checkout v1.0.0

# ç¡®è®¤åï¼ŒåŸºäºæ­¤ç‰ˆæœ¬åˆ›å»ºåˆ†æ”¯
git checkout -b rollback-to-1.0.0
git push -u origin rollback-to-1.0.0
```

### 5.2 å¸¸è§é—®é¢˜å¤„ç†ï¼šæ’é™¤æ•…éšœçš„æŠ€å·§

åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œéš¾å…é‡åˆ°å„ç§é—®é¢˜ã€‚è¿™é‡Œåˆ—ä¸¾æœ€å¸¸è§çš„é—®é¢˜åŠè§£å†³æ–¹æ¡ˆã€‚

#### é—®é¢˜1ï¼šè¯¯æäº¤æ•æ„Ÿä¿¡æ¯

**åœºæ™¯ï¼š**ä¸å°å¿ƒæŠŠå¯†ç ã€APIå¯†é’¥ç­‰æ•æ„Ÿä¿¡æ¯æäº¤äº†ã€‚

**è§£å†³æ–¹æ¡ˆï¼š**

**å¦‚æœè¿˜æ²¡pushï¼š**

```bash
# æ–¹æ³•1ï¼šä¿®æ”¹æœ€åä¸€æ¬¡æäº¤
git rm --cached config/secrets.py
echo "config/secrets.py" >> .gitignore
git add .gitignore
git commit --amend -m "chore: ç§»é™¤æ•æ„Ÿé…ç½®æ–‡ä»¶"

# æ–¹æ³•2ï¼šé‡ç½®åˆ°ä¸Šä¸€æ¬¡æäº¤
git reset HEAD~1
# åˆ é™¤æ•æ„Ÿä¿¡æ¯
git add .
git commit -m "chore: é‡æ–°æäº¤ï¼Œç§»é™¤æ•æ„Ÿä¿¡æ¯"
```

**å¦‚æœå·²ç»pushï¼š**

```bash
# ä½¿ç”¨git-filter-repoï¼ˆæ¨èï¼‰
pip install git-filter-repo

# åˆ é™¤æ–‡ä»¶çš„æ‰€æœ‰å†å²è®°å½•
git filter-repo --path config/secrets.py --invert-paths

# å¼ºåˆ¶æ¨é€
git push origin --force --all

# âš ï¸ é‡è¦ï¼š
# 1. ç«‹å³æ›´æ”¹æ³„éœ²çš„å¯†ç /å¯†é’¥
# 2. é€šçŸ¥å›¢é˜Ÿæˆå‘˜é‡æ–°å…‹éš†ä»“åº“
```

**ä½¿ç”¨BFG Repo-Cleanerï¼ˆå¦ä¸€ç§å·¥å…·ï¼‰ï¼š**

```bash
# ä¸‹è½½BFG
# https://rtyley.github.io/bfg-repo-cleaner/

# åˆ é™¤æ–‡ä»¶
java -jar bfg.jar --delete-files secrets.py

# æ¸…ç†
git reflog expire --expire=now --all
git gc --prune=now --aggressive
```

> âš ï¸ **è­¦å‘Š**ï¼šå¼ºåˆ¶æ¨é€ä¼šæ”¹å˜å†å²ï¼Œå›¢é˜Ÿæˆå‘˜éœ€è¦é‡æ–°å…‹éš†ä»“åº“ã€‚

#### é—®é¢˜2ï¼šä¿®æ”¹æœ€åä¸€æ¬¡commit

**åœºæ™¯1ï¼šæäº¤ä¿¡æ¯å†™é”™äº†**

```bash
git commit --amend -m "fix: ä¿®æ­£åçš„æäº¤ä¿¡æ¯"
```

**åœºæ™¯2ï¼šæ¼äº†ä¸€ä¸ªæ–‡ä»¶**

```bash
# æ·»åŠ é—æ¼çš„æ–‡ä»¶
git add forgotten_file.py

# è¿½åŠ åˆ°ä¸Šæ¬¡æäº¤
git commit --amend --no-edit
```

**åœºæ™¯3ï¼šä¿®æ”¹äº†å†…å®¹ï¼Œä¹Ÿè¦æ”¹æäº¤ä¿¡æ¯**

```bash
# ä¿®æ”¹æ–‡ä»¶
git add modified_file.py

# ä¿®æ”¹æäº¤
git commit --amend -m "fix: å®Œæ•´çš„ä¿®å¤"
```

> ğŸ’¡ **æç¤º**ï¼šå¦‚æœå·²ç»pushäº†ï¼Œamendåéœ€è¦force pushï¼ˆæ…ç”¨ï¼‰ã€‚

#### é—®é¢˜3ï¼šåˆå¹¶å¤šä¸ªcommit

**åœºæ™¯ï¼š**åŠŸèƒ½åˆ†æ”¯æœ‰10ä¸ªçç¢çš„commitï¼Œæƒ³åˆå¹¶æˆä¸€ä¸ªã€‚

```bash
# äº¤äº’å¼rebaseæœ€è¿‘10ä¸ªæäº¤
git rebase -i HEAD~10

# ç¼–è¾‘å™¨ä¼šæ‰“å¼€ï¼Œæ˜¾ç¤ºï¼š
# pick a1b2c3d feat: æ·»åŠ ç™»å½•æ¡†æ¶
# pick b2c3d4e fix: ä¿®å¤æ ·å¼
# pick c3d4e5f feat: æ·»åŠ éªŒè¯
# pick d4e5f6g fix: typo
# ...

# ä¿®æ”¹ä¸ºï¼š
# pick a1b2c3d feat: æ·»åŠ ç™»å½•æ¡†æ¶
# squash b2c3d4e fix: ä¿®å¤æ ·å¼
# squash c3d4e5f feat: æ·»åŠ éªŒè¯
# squash d4e5f6g fix: typo
# ...

# ä¿å­˜é€€å‡ºï¼Œä¼šæ‰“å¼€å¦ä¸€ä¸ªç¼–è¾‘å™¨è®©ä½ ç¼–è¾‘åˆå¹¶åçš„æäº¤ä¿¡æ¯
# ç¼–è¾‘å®Œæˆåä¿å­˜é€€å‡º

# å¦‚æœå·²pushï¼Œéœ€è¦force push
git push --force-with-lease
```

**é€‰é¡¹è¯´æ˜ï¼š**

- `pick`ï¼šä¿ç•™è¿™ä¸ªcommit
- `squash`ï¼šåˆå¹¶åˆ°å‰ä¸€ä¸ªcommit
- `fixup`ï¼šåˆå¹¶åˆ°å‰ä¸€ä¸ªcommitï¼Œä¸¢å¼ƒæäº¤ä¿¡æ¯
- `reword`ï¼šä¿®æ”¹æäº¤ä¿¡æ¯
- `edit`ï¼šåœä¸‹æ¥ä¿®æ”¹commit
- `drop`ï¼šåˆ é™¤commit

#### é—®é¢˜4ï¼šè¯¯åˆ é™¤åˆ†æ”¯çš„æ¢å¤

**åœºæ™¯ï¼š**ä¸å°å¿ƒåˆ é™¤äº†ä¸€ä¸ªåˆ†æ”¯ã€‚

```bash
# æŸ¥çœ‹æ‰€æœ‰æ“ä½œå†å²
git reflog

# è¾“å‡ºç±»ä¼¼ï¼š
# a1b2c3d HEAD@{0}: checkout: moving from feature/deleted to main
# b2c3d4e HEAD@{1}: commit: feat: é‡è¦åŠŸèƒ½
# c3d4e5f HEAD@{2}: commit: fix: ä¿®å¤é—®é¢˜
# ...

# æ‰¾åˆ°è¢«åˆ é™¤åˆ†æ”¯çš„æœ€åä¸€æ¬¡commitï¼ˆå¦‚b2c3d4eï¼‰
# é‡æ–°åˆ›å»ºåˆ†æ”¯
git branch feature/recovered b2c3d4e

# æˆ–è€…ç›´æ¥æ£€å‡º
git checkout -b feature/recovered b2c3d4e
```

> ğŸ’¡ **æç¤º**ï¼š`reflog`è®°å½•äº†HEADçš„ç§»åŠ¨å†å²ï¼Œå¯ä»¥æ‰¾å›"ä¸¢å¤±"çš„commitã€‚

#### é—®é¢˜5ï¼špushå¤±è´¥çš„å¸¸è§åŸå› 

**åŸå› 1ï¼šè¿œç¨‹æœ‰æ–°æäº¤**

```
! [rejected]        main -> main (fetch first)
error: failed to push some refs to 'xxx'
```

**è§£å†³ï¼š**

```bash
# å…ˆæ‹‰å–è¿œç¨‹æ›´æ–°
git pull --rebase

# è§£å†³å†²çªï¼ˆå¦‚æœæœ‰ï¼‰
# ...

# å†æ¨é€
git push
```

**åŸå› 2ï¼šåˆ†æ”¯ä¿æŠ¤**

```
! [remote rejected] main -> main (protected branch hook declined)
```

**è§£å†³ï¼š**

- æ£€æŸ¥æ˜¯å¦æœ‰æƒé™ç›´æ¥æ¨é€åˆ°æ­¤åˆ†æ”¯
- åº”è¯¥é€šè¿‡Pull Requeståˆå¹¶
- è”ç³»ç®¡ç†å‘˜è°ƒæ•´åˆ†æ”¯ä¿æŠ¤è®¾ç½®

**åŸå› 3ï¼šæ¨é€åˆ°é”™è¯¯çš„åˆ†æ”¯**

```bash
# æ£€æŸ¥å½“å‰åˆ†æ”¯
git branch

# æ£€æŸ¥è¿œç¨‹åˆ†æ”¯
git branch -r

# æ¨é€åˆ°æ­£ç¡®çš„åˆ†æ”¯
git push origin feature/your-feature
```

#### é—®é¢˜6ï¼šæœ¬åœ°å’Œè¿œç¨‹åˆ†æ”¯ä¸åŒæ­¥

**åœºæ™¯1ï¼šæœ¬åœ°åˆ†æ”¯è½å**

```bash
# æŸ¥çœ‹çŠ¶æ€
git status
# Your branch is behind 'origin/main' by 3 commits

# æ‹‰å–æ›´æ–°
git pull
```

**åœºæ™¯2ï¼šæœ¬åœ°åˆ†æ”¯é¢†å…ˆ**

```bash
# æŸ¥çœ‹çŠ¶æ€
git status
# Your branch is ahead of 'origin/main' by 2 commits

# æ¨é€åˆ°è¿œç¨‹
git push
```

**åœºæ™¯3ï¼šæœ¬åœ°å’Œè¿œç¨‹åˆ†å‰äº†**

```bash
# æŸ¥çœ‹çŠ¶æ€
git status
# Your branch and 'origin/main' have diverged

# æ–¹æ³•1ï¼šmerge
git pull

# æ–¹æ³•2ï¼šrebaseï¼ˆä¿æŒçº¿æ€§å†å²ï¼‰
git pull --rebase

# æ–¹æ³•3ï¼šå¦‚æœç¡®å®šè¿œç¨‹æ˜¯é”™çš„ï¼ˆæ…ç”¨ï¼‰
git push --force-with-lease
```

#### é—®é¢˜7ï¼šæ’¤é”€å·²ç»pushçš„commit

**åœºæ™¯ï¼š**pushäº†ä¸€ä¸ªé”™è¯¯çš„commitï¼Œéœ€è¦æ’¤é”€ã€‚

**æ–¹æ³•1ï¼šä½¿ç”¨revertï¼ˆæ¨èï¼Œä¸æ”¹å˜å†å²ï¼‰**

```bash
# åˆ›å»ºä¸€ä¸ªæ–°çš„commitæ¥æ’¤é”€
git revert HEAD
git push

# æ’¤é”€å¤šä¸ªæäº¤
git revert HEAD~3..HEAD
```

**æ–¹æ³•2ï¼šä½¿ç”¨resetï¼ˆæ”¹å˜å†å²ï¼Œéœ€è¦force pushï¼‰**

```bash
# å›é€€åˆ°ä¸Šä¸€ä¸ªcommit
git reset --hard HEAD~1

# å¼ºåˆ¶æ¨é€ï¼ˆå±é™©ï¼ï¼‰
git push --force-with-lease

# âš ï¸ åªåœ¨ä»¥ä¸‹æƒ…å†µä½¿ç”¨ï¼š
# 1. åˆ†æ”¯åªæœ‰ä½ è‡ªå·±åœ¨ç”¨
# 2. å›¢é˜ŸåŒæ„äº†è¿™ä¸ªæ“ä½œ
```

#### é—®é¢˜8ï¼šæ¢å¤å·²åˆ é™¤çš„æ–‡ä»¶

**åœºæ™¯1ï¼šè¯¯åˆ äº†å·¥ä½œåŒºçš„æ–‡ä»¶ï¼ˆè¿˜æ²¡commitï¼‰**

```bash
# æ¢å¤å•ä¸ªæ–‡ä»¶
git restore deleted_file.py

# æ¢å¤æ‰€æœ‰åˆ é™¤çš„æ–‡ä»¶
git restore .
```

**åœºæ™¯2ï¼šè¯¯åˆ å¹¶ä¸”å·²ç»commitäº†**

```bash
# æ‰¾åˆ°åˆ é™¤æ–‡ä»¶çš„commit
git log --all --full-history -- deleted_file.py

# æ¢å¤æ–‡ä»¶ï¼ˆä»åˆ é™¤å‰çš„é‚£ä¸ªcommitï¼‰
git checkout <commit-hash>~1 -- deleted_file.py

# æäº¤æ¢å¤
git add deleted_file.py
git commit -m "restore: æ¢å¤è¯¯åˆ çš„æ–‡ä»¶"
```

### 5.3 è¿›é˜¶å‘½ä»¤ï¼šå¤§å¸ˆçº§æŠ€èƒ½

#### git stash - ä¸´æ—¶ä¿å­˜ä¿®æ”¹

**ä½¿ç”¨åœºæ™¯ï¼š**

- æ­£åœ¨å¼€å‘åŠŸèƒ½ï¼Œçªç„¶éœ€è¦åˆ‡æ¢åˆ†æ”¯ä¿®bug
- æœ‰æœªæäº¤çš„ä¿®æ”¹ï¼Œä½†è¿˜ä¸æƒ³commit

**åŸºæœ¬æ“ä½œï¼š**

```bash
# ä¿å­˜å½“å‰ä¿®æ”¹
git stash

# æˆ–è€…æ·»åŠ è¯´æ˜
git stash save "WIP: æ­£åœ¨å¼€å‘ç™»å½•åŠŸèƒ½"

# æŸ¥çœ‹stashåˆ—è¡¨
git stash list
# è¾“å‡ºï¼š
# stash@{0}: WIP on feature/login: a1b2c3d feat: æ·»åŠ ç™»å½•è¡¨å•
# stash@{1}: WIP on main: b2c3d4e fix: ä¿®å¤bug

# åº”ç”¨stashï¼ˆä¿ç•™stashï¼‰
git stash apply

# åº”ç”¨å¹¶åˆ é™¤stash
git stash pop

# åº”ç”¨ç‰¹å®šçš„stash
git stash apply stash@{1}

# åˆ é™¤stash
git stash drop stash@{0}

# æ¸…ç©ºæ‰€æœ‰stash
git stash clear
```

**é«˜çº§ç”¨æ³•ï¼š**

```bash
# åªstashæœªæš‚å­˜çš„ä¿®æ”¹
git stash --keep-index

# åŒ…æ‹¬æœªè·Ÿè¸ªçš„æ–‡ä»¶
git stash --include-untracked
# æˆ–ç®€å†™
git stash -u

# åˆ›å»ºåˆ†æ”¯å¹¶åº”ç”¨stash
git stash branch feature/from-stash stash@{0}
```

**å®æˆ˜åœºæ™¯ï¼š**

```bash
# æ­£åœ¨å¼€å‘feature
# ä¿®æ”¹äº†å¾ˆå¤šæ–‡ä»¶ï¼Œä½†è¿˜ä¸æƒ³æäº¤

# çªç„¶éœ€è¦ä¿®å¤ä¸€ä¸ªç´§æ€¥bug
git stash save "WIP: feature/user-profile"

# åˆ‡æ¢åˆ°hotfixåˆ†æ”¯
git checkout main
git checkout -b hotfix/critical-bug

# ä¿®å¤bug
# ...
git add .
git commit -m "fix: ä¿®å¤ç´§æ€¥bug"

# åˆ‡å›featureåˆ†æ”¯
git checkout feature/user-profile

# æ¢å¤ä¹‹å‰çš„å·¥ä½œ
git stash pop

# ç»§ç»­å¼€å‘
```

#### git cherry-pick - ç²¾ç¡®é€‰æ‹©æäº¤

**ä½¿ç”¨åœºæ™¯ï¼š**

- åªæƒ³è¦æŸä¸ªåˆ†æ”¯çš„ç‰¹å®šå‡ ä¸ªcommit
- è¯¯æäº¤åˆ°é”™è¯¯çš„åˆ†æ”¯ï¼Œæƒ³è½¬ç§»åˆ°æ­£ç¡®çš„åˆ†æ”¯

**åŸºæœ¬æ“ä½œï¼š**

```bash
# åº”ç”¨å•ä¸ªcommit
git cherry-pick a1b2c3d

# åº”ç”¨å¤šä¸ªcommit
git cherry-pick a1b2c3d b2c3d4e c3d4e5f

# åº”ç”¨ä¸€ä¸ªèŒƒå›´çš„commitï¼ˆä¸åŒ…æ‹¬startï¼‰
git cherry-pick start-commit..end-commit

# åº”ç”¨ä¸€ä¸ªèŒƒå›´çš„commitï¼ˆåŒ…æ‹¬startï¼‰
git cherry-pick start-commit^..end-commit
```

**å¤„ç†å†²çªï¼š**

```bash
# cherry-pickæ—¶å¦‚æœæœ‰å†²çª
git cherry-pick a1b2c3d

# è§£å†³å†²çª
# ç¼–è¾‘æ–‡ä»¶...
git add .

# ç»§ç»­cherry-pick
git cherry-pick --continue

# æˆ–è€…æ”¾å¼ƒ
git cherry-pick --abort
```

**å®æˆ˜åœºæ™¯ï¼š**

```bash
# åœºæ™¯ï¼šåœ¨featureåˆ†æ”¯å®ç°äº†ä¸€ä¸ªé‡è¦ä¿®å¤
# ä½†è¿™ä¸ªä¿®å¤ä¹Ÿéœ€è¦åº”ç”¨åˆ°mainåˆ†æ”¯

# åœ¨featureåˆ†æ”¯æŸ¥çœ‹commit
git log --oneline
# a1b2c3d fix: ä¿®å¤å†…å­˜æ³„æ¼é—®é¢˜

# åˆ‡æ¢åˆ°mainåˆ†æ”¯
git checkout main

# åº”ç”¨é‚£ä¸ªä¿®å¤
git cherry-pick a1b2c3d

# æ¨é€
git push
```

#### git rebase - å˜åŸºæ“ä½œ

**ä½¿ç”¨åœºæ™¯ï¼š**

- ä¿æŒåˆ†æ”¯å†å²çº¿æ€§
- æ•´ç†æäº¤å†å²
- å°†å¤šä¸ªcommitåˆå¹¶

**åŸºæœ¬æ¦‚å¿µï¼š**

```
å˜åŸºå‰ï¼š
    A---B---C  main
         \
          D---E---F  feature

å˜åŸºåï¼š
    A---B---C  main
             \
              D'---E'---F'  feature
```

**åŸºæœ¬æ“ä½œï¼š**

```bash
# å°†å½“å‰åˆ†æ”¯å˜åŸºåˆ°ç›®æ ‡åˆ†æ”¯
git rebase main

# äº¤äº’å¼rebaseï¼ˆæ•´ç†æœ€è¿‘3ä¸ªæäº¤ï¼‰
git rebase -i HEAD~3

# ç»§ç»­rebaseï¼ˆè§£å†³å†²çªåï¼‰
git add .
git rebase --continue

# è·³è¿‡å½“å‰commit
git rebase --skip

# æ”¾å¼ƒrebase
git rebase --abort
```

**äº¤äº’å¼rebaseç¤ºä¾‹ï¼š**

```bash
git rebase -i HEAD~3

# ç¼–è¾‘å™¨æ‰“å¼€ï¼š
pick a1b2c3d feat: æ·»åŠ åŠŸèƒ½A
pick b2c3d4e fix: ä¿®å¤typo
pick c3d4e5f feat: å®Œå–„åŠŸèƒ½A

# å¯ä»¥è¿™æ ·ä¿®æ”¹ï¼š
pick a1b2c3d feat: æ·»åŠ åŠŸèƒ½A
fixup b2c3d4e fix: ä¿®å¤typo
squash c3d4e5f feat: å®Œå–„åŠŸèƒ½A

# ä¿å­˜åï¼Œtypoçš„commitä¼šè¢«åˆå¹¶åˆ°ç¬¬ä¸€ä¸ª
# ç¬¬ä¸‰ä¸ªcommitä¼šåˆå¹¶åˆ°å‰é¢å¹¶å¯ä»¥ç¼–è¾‘æäº¤ä¿¡æ¯
```

**æœ€ä½³å®è·µï¼š**

âœ… **é€‚åˆrebaseçš„åœºæ™¯ï¼š**

- æ•´ç†è‡ªå·±çš„featureåˆ†æ”¯å†å²
- åŒæ­¥ä¸»åˆ†æ”¯çš„æ›´æ–°åˆ°featureåˆ†æ”¯
- å‘å¸ƒå‰æ¸…ç†æäº¤å†å²

âŒ **ä¸è¦rebaseçš„åœºæ™¯ï¼š**

- å·²ç»pushåˆ°å…¬å…±åˆ†æ”¯çš„æäº¤
- å¤šäººåä½œçš„åˆ†æ”¯
- ä¸»åˆ†æ”¯ï¼ˆmain/developï¼‰

#### git reflog - æ“ä½œå†å²è®°å½•

`reflog`æ˜¯Gitçš„å®‰å…¨ç½‘ï¼Œè®°å½•äº†æ‰€æœ‰HEADçš„ç§»åŠ¨ã€‚

```bash
# æŸ¥çœ‹reflog
git reflog

# è¾“å‡ºç¤ºä¾‹ï¼š
# a1b2c3d HEAD@{0}: commit: feat: æ–°åŠŸèƒ½
# b2c3d4e HEAD@{1}: reset: moving to HEAD~1
# c3d4e5f HEAD@{2}: commit: fix: ä¿®å¤bug
# d4e5f6g HEAD@{3}: checkout: moving from main to feature

# æ¢å¤åˆ°ç‰¹å®šçŠ¶æ€
git reset --hard HEAD@{2}

# æŸ¥çœ‹æŸä¸ªåˆ†æ”¯çš„reflog
git reflog show feature/login
```

**æ•‘å‘½åœºæ™¯ï¼š**

```bash
# åœºæ™¯ï¼šè¯¯æ“ä½œåæƒ³æ¢å¤

# 1. ä¸å°å¿ƒreset --hardä¸¢å¤±äº†æäº¤
git reflog
# æ‰¾åˆ°ä¸¢å¤±çš„commit
git reset --hard <commit-hash>

# 2. è¯¯åˆ é™¤åˆ†æ”¯åæ¢å¤
git reflog
# æ‰¾åˆ°åˆ†æ”¯çš„æœ€åä¸€ä¸ªcommit
git branch recovered-branch <commit-hash>
```

#### git bisect - äºŒåˆ†æŸ¥æ‰¾bug

**ä½¿ç”¨åœºæ™¯ï¼š**æŸä¸ªbugä¸çŸ¥é“æ˜¯å“ªä¸ªcommitå¼•å…¥çš„ã€‚

```bash
# å¼€å§‹bisect
git bisect start

# æ ‡è®°å½“å‰ç‰ˆæœ¬æœ‰bug
git bisect bad

# æ ‡è®°å·²çŸ¥çš„å¥½ç‰ˆæœ¬
git bisect good v1.0.0

# Gitä¼šè‡ªåŠ¨checkoutåˆ°ä¸­é—´çš„commit
# æµ‹è¯•è¿™ä¸ªç‰ˆæœ¬...

# å¦‚æœæœ‰bug
git bisect bad

# å¦‚æœæ²¡æœ‰bug
git bisect good

# é‡å¤ä¸Šè¿°è¿‡ç¨‹ï¼ŒGitä¼šé€æ­¥ç¼©å°èŒƒå›´
# æœ€ç»ˆæ‰¾åˆ°å¼•å…¥bugçš„commit

# ç»“æŸbisect
git bisect reset
```

**è‡ªåŠ¨åŒ–bisectï¼š**

```bash
# ä½¿ç”¨è„šæœ¬è‡ªåŠ¨æµ‹è¯•
git bisect start
git bisect bad
git bisect good v1.0.0

# è¿è¡Œæµ‹è¯•è„šæœ¬
git bisect run python test_script.py

# Gitä¼šè‡ªåŠ¨è¿è¡Œè„šæœ¬å¹¶æ ‡è®°good/bad
# ç›´åˆ°æ‰¾åˆ°å¼•å…¥bugçš„commit
```

### 5.4 æœ€ä½³å®è·µæ€»ç»“ï¼šå¤§å¸ˆçš„ç®´è¨€

#### æäº¤é¢‘ç‡å»ºè®®

**âœ… åº”è¯¥ï¼š**

- å®Œæˆä¸€ä¸ªå°åŠŸèƒ½å°±commit
- ä¿®å¤ä¸€ä¸ªbugå°±commit
- é‡æ„ä¸€ä¸ªæ¨¡å—å°±commit
- commitåº”è¯¥æ˜¯**åŸå­æ€§**çš„ï¼ˆä¸€ä¸ªcommitåªåšä¸€ä»¶äº‹ï¼‰

**âŒ ä¸åº”è¯¥ï¼š**

- ä¸€å¤©çš„å·¥ä½œåªcommitä¸€æ¬¡
- æŠŠå¤šä¸ªä¸ç›¸å…³çš„æ”¹åŠ¨æ”¾åœ¨ä¸€ä¸ªcommit
- åŒ…å«åŠæˆå“æˆ–æ— æ³•è¿è¡Œçš„ä»£ç 

**é»„é‡‘è§„åˆ™ï¼š**

> æ¯ä¸ªcommitåº”è¯¥æ˜¯å¯ä»¥ç‹¬ç«‹ç†è§£çš„ï¼Œå¹¶ä¸”è®©é¡¹ç›®å¤„äºå¯è¿è¡ŒçŠ¶æ€ã€‚

#### åˆ†æ”¯ç”Ÿå‘½å‘¨æœŸç®¡ç†

**featureåˆ†æ”¯ï¼š**

- ç”Ÿå‘½å‘¨æœŸï¼š1-5å¤©
- è¶…è¿‡ä¸€å‘¨çš„featureåº”è¯¥æ‹†åˆ†
- å®Œæˆåç«‹å³åˆå¹¶ï¼Œä¸è¦é•¿æœŸä¿ç•™

**releaseåˆ†æ”¯ï¼š**

- ç”Ÿå‘½å‘¨æœŸï¼š1-3å¤©
- ä»…ç”¨äºå‡†å¤‡å‘å¸ƒï¼Œä¸å¼€å‘æ–°åŠŸèƒ½
- å‘å¸ƒåç«‹å³åˆ é™¤

**hotfixåˆ†æ”¯ï¼š**

- ç”Ÿå‘½å‘¨æœŸï¼šæ•°å°æ—¶åˆ°1å¤©
- å°½å¿«ä¿®å¤å¹¶åˆå¹¶
- ä¿®å¤åç«‹å³åˆ é™¤

**å®šæœŸæ¸…ç†ï¼š**

```bash
# æ¯å‘¨æ¸…ç†å·²åˆå¹¶çš„æœ¬åœ°åˆ†æ”¯
git branch --merged main | grep -v "main" | xargs git branch -d

# æ¸…ç†è¿œç¨‹å·²åˆ é™¤çš„å¼•ç”¨
git fetch --prune
```

#### å›¢é˜Ÿæ²Ÿé€šåä½œè¦ç‚¹

**1. å¼€å§‹å·¥ä½œå‰æ²Ÿé€š**

- å‘ŠçŸ¥å›¢é˜Ÿä½ è¦åšä»€ä¹ˆ
- åˆ›å»ºIssueæè¿°éœ€æ±‚
- åˆ†é…ç»™è‡ªå·±é¿å…é‡å¤å·¥ä½œ

**2. å¼€å‘ä¸­ä¿æŒåŒæ­¥**

- æ¯å¤©å¼€å§‹å‰ `git pull`
- å®šæœŸpushé¿å…ä»£ç ä¸¢å¤±
- é‡å¤§æ”¹åŠ¨æå‰é€šçŸ¥å›¢é˜Ÿ

**3. æäº¤PRå‰**

- è‡ªå·±å…ˆreviewä¸€éä»£ç 
- ç¡®ä¿æµ‹è¯•é€šè¿‡
- æ›´æ–°ç›¸å…³æ–‡æ¡£
- å¡«å†™è¯¦ç»†çš„PRæè¿°

**4. å®¡æŸ¥ä»£ç æ—¶**

- åŠæ—¶å“åº”PRè¯·æ±‚
- æä¾›å»ºè®¾æ€§çš„æ„è§
- ä¸è¦åªæ˜¯æ‰¹è¯„ï¼Œç»™å‡ºæ”¹è¿›å»ºè®®
- è®¤å¯å¥½çš„å®è·µ

#### æŒç»­é›†æˆ/æŒç»­éƒ¨ç½²ï¼ˆCI/CDï¼‰ç®€ä»‹

**ä»€ä¹ˆæ˜¯CI/CDï¼Ÿ**

- **CIï¼ˆContinuous Integrationï¼‰**ï¼šæŒç»­é›†æˆ

  - è‡ªåŠ¨è¿è¡Œæµ‹è¯•
  - è‡ªåŠ¨æ£€æŸ¥ä»£ç è´¨é‡
  - åŠæ—©å‘ç°é—®é¢˜
- **CDï¼ˆContinuous Deployment/Deliveryï¼‰**ï¼šæŒç»­éƒ¨ç½²/äº¤ä»˜

  - è‡ªåŠ¨éƒ¨ç½²åˆ°æµ‹è¯•/ç”Ÿäº§ç¯å¢ƒ
  - åŠ å¿«å‘å¸ƒé€Ÿåº¦

**ä¸Gitçš„é›†æˆï¼š**

```yaml
# .gitea/workflows/ci.yml ç¤ºä¾‹ï¼ˆGitea Actionsï¼‰
name: CI

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
    
      - name: è®¾ç½®Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
    
      - name: å®‰è£…ä¾èµ–
        run: |
          pip install -r requirements.txt
    
      - name: è¿è¡Œæµ‹è¯•
        run: |
          pytest tests/
    
      - name: ä»£ç è´¨é‡æ£€æŸ¥
        run: |
          flake8 src/
```

**å¥½å¤„ï¼š**

- âœ… è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œé¿å…äººå·¥é—æ¼
- âœ… ä¿è¯ä»£ç è´¨é‡
- âœ… å¿«é€Ÿåé¦ˆé—®é¢˜
- âœ… é™ä½éƒ¨ç½²é£é™©

#### Gitå·¥ä½œæµç¨‹æ€»ç»“

**æ—¥å¸¸å¼€å‘æµç¨‹ï¼š**

```bash
# æ¯å¤©å¼€å§‹å·¥ä½œ
git checkout develop
git pull

# åˆ›å»ºfeatureåˆ†æ”¯
git checkout -b feature/new-feature

# å¼€å‘å’Œæäº¤
# ... ç¼–å†™ä»£ç 
git add .
git commit -m "feat: å®ç°XXXåŠŸèƒ½"

# å®šæœŸæ¨é€
git push

# å¼€å‘å®Œæˆï¼ŒåŒæ­¥ä¸»åˆ†æ”¯
git fetch origin
git rebase origin/develop

# åˆ›å»ºPR
# åœ¨Giteaç½‘é¡µä¸Šåˆ›å»ºPull Request

# PRåˆå¹¶åï¼Œæ¸…ç†åˆ†æ”¯
git checkout develop
git pull
git branch -d feature/new-feature
```

**å‘å¸ƒæµç¨‹ï¼š**

```bash
# åˆ›å»ºreleaseåˆ†æ”¯
git checkout develop
git pull
git checkout -b release/1.0.0

# æ›´æ–°ç‰ˆæœ¬å·å’Œæ–‡æ¡£
# ...
git commit -m "chore: bump version to 1.0.0"

# æµ‹è¯•
# ...

# åˆå¹¶åˆ°main
git checkout main
git merge --no-ff release/1.0.0
git tag -a v1.0.0 -m "Release 1.0.0"
git push origin main --tags

# åˆå¹¶å›develop
git checkout develop
git merge --no-ff release/1.0.0
git push origin develop

# åˆ é™¤releaseåˆ†æ”¯
git branch -d release/1.0.0
git push origin --delete release/1.0.0
```

#### å¸¸ç”¨Gité…ç½®æ¨è

```bash
# å…¨å±€é…ç½®
git config --global user.name "ä½ çš„åå­—"
git config --global user.email "your.email@example.com"

# é»˜è®¤ç¼–è¾‘å™¨
git config --global core.editor "vim"

# é¢œè‰²æ˜¾ç¤º
git config --global color.ui auto

# é»˜è®¤åˆ†æ”¯å
git config --global init.defaultBranch main

# pullæ—¶ä½¿ç”¨rebase
git config --global pull.rebase true

# æ¨é€æ—¶è‡ªåŠ¨è®¾ç½®upstream
git config --global push.autoSetupRemote true

# diffå·¥å…·
git config --global diff.tool vimdiff

# mergeå·¥å…·
git config --global merge.tool vimdiff

# æ˜¾ç¤ºä¸­æ–‡æ–‡ä»¶å
git config --global core.quotepath false

# è‡ªåŠ¨çº æ­£æ‹¼å†™é”™è¯¯
git config --global help.autocorrect 1

# æŸ¥çœ‹æ‰€æœ‰é…ç½®
git config --global --list
```

#### Gitåˆ«åï¼ˆAliasï¼‰æé«˜æ•ˆç‡

```bash
# å¸¸ç”¨åˆ«å
git config --global alias.st status
git config --global alias.co checkout
git config --global alias.br branch
git config --global alias.ci commit
git config --global alias.unstage 'reset HEAD --'
git config --global alias.last 'log -1 HEAD'
git config --global alias.lg "log --color --graph --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)<%an>%Creset' --abbrev-commit"

# ä½¿ç”¨åˆ«å
git st          # ä»£æ›¿ git status
git co main     # ä»£æ›¿ git checkout main
git br          # ä»£æ›¿ git branch
git lg          # æ¼‚äº®çš„logæ˜¾ç¤º
```

#### å°ç»“ï¼šè¿›é˜¶æŠ€èƒ½æŒæ¡

æ­å–œä½ å­¦ä¹ äº†Gitçš„è¿›é˜¶æŠ€å·§ï¼ç°åœ¨ä½ å·²ç»æŒæ¡äº†ï¼š

âœ… **æ ‡ç­¾ç®¡ç†**

- åˆ›å»ºå’Œç®¡ç†æ ‡ç­¾
- è¯­ä¹‰åŒ–ç‰ˆæœ¬å·
- åŸºäºæ ‡ç­¾çš„å‘å¸ƒæµç¨‹

âœ… **å¸¸è§é—®é¢˜å¤„ç†**

- æ•æ„Ÿä¿¡æ¯æ³„éœ²çš„è¡¥æ•‘
- æäº¤çš„ä¿®æ”¹å’Œåˆå¹¶
- åˆ†æ”¯çš„æ¢å¤
- pushå¤±è´¥çš„åŸå› å’Œè§£å†³

âœ… **è¿›é˜¶å‘½ä»¤**

- `git stash`ï¼šä¸´æ—¶ä¿å­˜ä¿®æ”¹
- `git cherry-pick`ï¼šç²¾ç¡®é€‰æ‹©æäº¤
- `git rebase`ï¼šå˜åŸºå’Œæ•´ç†å†å²
- `git reflog`ï¼šæ‰¾å›ä¸¢å¤±çš„æäº¤
- `git bisect`ï¼šå®šä½é—®é¢˜æäº¤

âœ… **æœ€ä½³å®è·µ**

- åˆç†çš„æäº¤é¢‘ç‡
- åˆ†æ”¯ç”Ÿå‘½å‘¨æœŸç®¡ç†
- å›¢é˜Ÿæ²Ÿé€šè¦ç‚¹
- CI/CDç®€ä»‹
- Gité…ç½®ä¼˜åŒ–

ç°åœ¨ï¼Œä½ å·²ç»å…·å¤‡äº†Gitå¤§å¸ˆçš„æŠ€èƒ½ï¼è®©æˆ‘ä»¬é€šè¿‡é™„å½•æŸ¥é˜…å¸¸ç”¨å‘½ä»¤å’Œæœ¯è¯­ï¼Œæˆä¸ºçœŸæ­£çš„ä¸“å®¶ï¼

---
